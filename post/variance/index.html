<!doctype html><html lang><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Variance in type systems | Samyak Sarnayak</title>
<meta name=description content="Variance in type systems"><meta property="og:site_name" content="Samyak Sarnayak"><meta property="og:title" content="Variance in type systems - Samyak Sarnayak"><meta property="og:description" content="A brief explanation of what covariant, contravariant and invariant mean. With examples in various languages."><meta property="og:image" content="https://samyak.me/images/mob.png"><meta name=keywords content><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload=renderMathInElement(document.body)></script><script data-goatcounter=https://samyak.goatcounter.com/count async src=//gc.zgo.at/count.js></script><meta name=keywords content="Samyak,Sarnayak,PES,Software"><link rel=icon type=image/svg href=https://samyak.me/img/logo.png><meta name=author content='samyak_sarnayak'><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.146.4"><link rel=stylesheet href=https://samyak.me/sass/main.min.73561462541a05e8aca52f0d514d3498788c0fb7a1cfe783a809fda8d591f238.css type=text/css media=screen><link rel=stylesheet href=https://samyak.me/sass/custom.min.2802693dbd5b636f729bbbf8919cd162693901a6228f8dd88a6f1f496c619307.css></head><body><div class=line id=scrollIndicator></div><div class=main><div class=title><div class=name><h2><a href=https://samyak.me/ style=text-decoration:none;color:inherit>Samyak Sarnayak</a></h2></div><div class=color-scheme><input type=checkbox class=checkbox id=chk>
<label class=label for=chk><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 160c-52.9.0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6.0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0s-49.9-131.1.0-181 131.1-49.9 181 0 49.9 131.1.0 181z"/></svg><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="moon" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M283.211 512c78.962.0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954.0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156.0 00283.211.0c-141.309.0-256 114.511-256 256 0 141.309 114.511 256 256 256z"/></svg><div class=ball></div></label></div></div><script>let currentTheme="light";const themeSetter=e=>{currentTheme=e,document.body.classList.toggle("dark"),localStorage.setItem("theme",e),blockSwitcher(),window.customThemeCallback&&customThemeCallback(e)},blockSwitcher=()=>[...document.getElementsByTagName("BLOCKQUOTE")].forEach(e=>e.classList.toggle("dark")),styleSwapper=()=>{document.body.classList.add("back-transition"),localStorage.getItem("theme")==="dark"?themeSetter("light"):localStorage.getItem("theme")==="light"&&themeSetter("dark")};localStorage.getItem("theme")==="light"?(localStorage.setItem("theme","light"),window.customThemeCallback&&customThemeCallback("light")):(themeSetter("dark"),document.addEventListener("DOMContentLoaded",blockSwitcher)),document.getElementById("chk").addEventListener("change",styleSwapper),window.addEventListener("scroll",()=>{let e=document.documentElement.scrollHeight-document.documentElement.clientHeight;if(e>=500){let t=document.body.scrollTop||document.documentElement.scrollTop,n=t/e*100;document.getElementById("scrollIndicator").style.width=n+"%"}})</script><section class=intro><div class=post-header><a class=go-back href=https://samyak.me/><svg aria-hidden="true" focusable="false" data-prefix="far" class="back-icon" data-icon="caret-square-left" height="25" role="img" viewBox="0 0 448 512"><path fill="currentcolor" d="M272 157.1v197.8c0 10.7-13 16.1-20.5 8.5l-98.3-98.9c-4.7-4.7-4.7-12.2.0-16.9l98.3-98.9c7.5-7.7 20.5-2.3 20.5 8.4zM448 80v352c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5.0 48 21.5 48 48zm-48 346V86c0-3.3-2.7-6-6-6H54c-3.3.0-6 2.7-6 6v340c0 3.3 2.7 6 6 6h340c3.3.0 6-2.7 6-6z"/></svg></a><h2 class=post-title>Variance in type systems</h2></div><div class=post-dets><div class=post-det-entry>19 min</div><div class=post-det-entry>April 13, 2025</div><div class=post-det-entry></div></div><span class=tags>Tagged:&nbsp;<h5><a class=tag href=https://samyak.me/tags/types>types</a></h5><h5><a class=tag href=https://samyak.me/tags/pl>pl</a></h5><h5><a class=tag href=https://samyak.me/tags/rust>rust</a></h5><h5><a class=tag href=https://samyak.me/tags/python>python</a></h5><h5><a class=tag href=https://samyak.me/tags/typescript>typescript</a></h5></span><div class=content><nav id=TableOfContents><ul><li><a href=#generic-types>Generic types</a></li><li><a href=#subtyping>Subtyping</a></li><li><a href=#variance>Variance</a></li><li><a href=#an-example>An example</a><ul><li><ul><li><a href=#a-note-on-multiple-type-parameters>A note on multiple type parameters</a></li></ul></li></ul></li><li><a href=#other-languages>Other languages</a><ul><li><a href=#python>Python</a></li><li><a href=#typescript>Typescript</a></li><li><a href=#rust>Rust</a><ul><li><a href=#a-note-on-trait-upcasting>A note on trait upcasting</a></li></ul></li></ul></li></ul></nav><p>Understanding variance will help us better reason about behaviors of <em>generic</em> types. Even if you have never defined your own generic types, you have almost certainly interacted with them in everyday programming.</p><p>Before we begin, there are a few terms we need to be familiar with.</p><h1 id=generic-types>Generic types
<a class=heading-anchor href=#generic-types>#</a></h1><p>A type is considered generic if it has placeholders for other types within it. These placeholders are called <strong>type parameters</strong>. For example, an array is a type which is generic over its element type. You will see this in different forms in different languages. <code>list[T]</code> in Python; <code>std::vector&lt;T></code> in C++; <code>Vec&lt;T></code> in Rust; <code>List&lt;T></code> in java and so on.</p><p>The point of generics is usually to re-use code. You can write code for an array/list/hashmap once and have it support <em>any</em> type of element. In some compiled languages (for example, C++ and Rust), generics also provide great runtime performance because the compiler generates specific implementations for each type â€” a process known as <em>monomorphization</em> <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><h1 id=subtyping>Subtyping
<a class=heading-anchor href=#subtyping>#</a></h1><p>This can take many forms. One common form is through <em>inheritance</em> in languages like Java, C++ and Python. A class Y is a <em>subtype</em> of X if Y is a <em>sub-class</em> of X (i.e., Y extends X). This subtyping relationship is written as <code>Y &lt;: X</code>. Another way to look at subtyping is substitution. If a Y can be used in places where a X is needed, we say Y is a subtype of X. For example, we can use a Cat in places where an Animal is needed. This means Cat is a subtype of Animal, or <code>Cat &lt;: Animal</code>.</p><p>In the case of Rust, there&rsquo;s no subtyping relationship between any <em>types</em>. This is because Rust doesn&rsquo;t support inheritance. However, there are subtyping relations between <em>lifetimes</em>. More on this later (skip to the <a href=#rust>Rust section</a> for it).</p><h1 id=variance>Variance
<a class=heading-anchor href=#variance>#</a></h1><p>The concept of variance shows up in the intersection of generics and subtyping.</p><ul><li><p>A generic type <code>Something[T]</code> is <strong>covariant</strong> in T if <code>B</code> being a subtype of <code>A</code> means that <code>Something[B]</code> is a subtype of <code>Something[A]</code>.</p><ul><li>If <code>B &lt;: A</code> then <code>Something[B] &lt;: Something[A]</code>.</li></ul></li><li><p>A generic type <code>Something[T]</code> is <strong>contravariant</strong> in T if <code>B</code> being a subtype of <code>A</code> means that <code>Something[A]</code> is a subtype of <code>Something[B]</code>.</p><ul><li>If <code>B &lt;: A</code> then <code>Something[A] &lt;: Something[B]</code>.</li></ul></li><li><p>A generic type <code>Something[T]</code> is <strong>invariant</strong> in T if <code>B</code> being a subtype of <code>A</code> does <em>not</em> mean that <code>Something[B]</code> is a subtype of <code>Something[A]</code>. In other words, there is no subtyping relation between <code>Something[A]</code> and <code>Something[B]</code>.</p><ul><li>If a <code>Something[A]</code> is required, there is no replacement for it. No <code>Something[B]</code> can be provided in place of a <code>Something[A]</code>.</li></ul></li></ul><h1 id=an-example>An example
<a class=heading-anchor href=#an-example>#</a></h1><p>Let&rsquo;s understand this with an example in Python. Consider this function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>some_func</span>(<span style=color:#8be9fd;font-style:italic>input</span>: <span style=color:#8be9fd;font-style:italic>list</span>[<span style=color:#8be9fd;font-style:italic>int</span> <span style=color:#ff79c6>|</span> <span style=color:#8be9fd;font-style:italic>str</span>]):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;i take int or str&#34;</span>, <span style=color:#8be9fd;font-style:italic>input</span>)
</span></span></code></pre></div><p>It takes a list of integers or strings, i.e., it can have both ints and strings in the same list. If I try to pass a list of only ints to it,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>int_list: <span style=color:#8be9fd;font-style:italic>list</span>[<span style=color:#8be9fd;font-style:italic>int</span>] <span style=color:#ff79c6>=</span> [<span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>2</span>, <span style=color:#bd93f9>3</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>some_func(int_list)
</span></span></code></pre></div><p>I get this
<span class=sidenote><label class=sidenote-label for=sidenote-1>type error</label>
<input class=sidenote-checkbox type=checkbox checked id=sidenote-1></input>
<span class="sidenote-content sidenote-right">Python does no type-checking at runtime. So this program will run just fine.
To see these errors, you need to use a typechecker like <a href=https://github.com/python/mypy>mypy</a> or <a href=https://github.com/microsoft/pyright>pyright</a>. You can check out this example on the <a href="https://pyright-play.net/?code=CYUwZgBAzg9gtiA%2BmArgOwMYAoCWaAOKALgFwQA2OURA2nkRAD7REBOAugJQkBQE-EfK3pYARDghEAhgGsQEehBisWrUQBoFBYpx496iStTJHa9dhAC8EGgEZNAJk0Bmdj1gJk6bAdOcgA">pyright playground</a>.</span></span></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#bd93f9>1.</span> Argument of <span style=color:#8be9fd;font-style:italic>type</span> <span style=color:#f1fa8c>&#34;list[int]&#34;</span> cannot be assigned to parameter <span style=color:#f1fa8c>&#34;input&#34;</span> of <span style=color:#8be9fd;font-style:italic>type</span> <span style=color:#f1fa8c>&#34;list[int | str]&#34;</span> <span style=color:#ff79c6>in</span> function <span style=color:#f1fa8c>&#34;some_func&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>   Â Â <span style=color:#f1fa8c>&#34;list[int]&#34;</span> <span style=color:#ff79c6>is</span> <span style=color:#ff79c6>not</span> assignable to <span style=color:#f1fa8c>&#34;list[int | str]&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>   Â Â Â Â Type parameter <span style=color:#f1fa8c>&#34;_T@list&#34;</span> <span style=color:#ff79c6>is</span> invariant, but <span style=color:#f1fa8c>&#34;int&#34;</span> <span style=color:#ff79c6>is</span> <span style=color:#ff79c6>not</span> the same <span style=color:#ff79c6>as</span> <span style=color:#f1fa8c>&#34;int | str&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>   Â Â Â Â Consider switching <span style=color:#ff79c6>from</span> <span style=color:#f1fa8c>&#34;list&#34;</span> to <span style=color:#f1fa8c>&#34;Sequence&#34;</span> which <span style=color:#ff79c6>is</span> covariant
</span></span></code></pre></div><p>But this works:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>a_int_or_str: <span style=color:#8be9fd;font-style:italic>int</span> <span style=color:#ff79c6>|</span> <span style=color:#8be9fd;font-style:italic>str</span> <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>5</span>
</span></span></code></pre></div><p>That means <code>int</code> can be assigned to <code>int | str</code>. In other words, <code>int</code> is a subtype of <code>int | str</code>.</p><p>The error says that <code>list[T]</code> is invariant on <code>T</code>. But why? What&rsquo;s wrong with passing a <code>list[int]</code> to a <code>list[int | str]</code>? The reason, in Python, is mutability. A list can be mutated at any point. The function can append a string to the input:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>some_func</span>(<span style=color:#8be9fd;font-style:italic>input</span>: <span style=color:#8be9fd;font-style:italic>list</span>[<span style=color:#8be9fd;font-style:italic>int</span> <span style=color:#ff79c6>|</span> <span style=color:#8be9fd;font-style:italic>str</span>]):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;i take int or str&#34;</span>, <span style=color:#8be9fd;font-style:italic>input</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#8be9fd;font-style:italic>input</span><span style=color:#ff79c6>.</span>append(<span style=color:#f1fa8c>&#34;hello there&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>int_list: <span style=color:#8be9fd;font-style:italic>list</span>[<span style=color:#8be9fd;font-style:italic>int</span>] <span style=color:#ff79c6>=</span> [<span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>2</span>, <span style=color:#bd93f9>3</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>some_func(int_list)
</span></span></code></pre></div><p>Now the type of <code>int_list</code> outside will be wrong after this function call! It will no longer be a <code>list[int]</code>.</p><p>The solution for our first function is to use <code>typing.Sequence[T]</code>, which is covariant. The type error message we saw also hints at this (see the last line).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>from</span> typing <span style=color:#ff79c6>import</span> Sequence
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>some_func</span>(<span style=color:#8be9fd;font-style:italic>input</span>: Sequence[<span style=color:#8be9fd;font-style:italic>int</span> <span style=color:#ff79c6>|</span> <span style=color:#8be9fd;font-style:italic>str</span>]):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;i take int or str&#34;</span>, <span style=color:#8be9fd;font-style:italic>input</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>int_list: <span style=color:#8be9fd;font-style:italic>list</span>[<span style=color:#8be9fd;font-style:italic>int</span>] <span style=color:#ff79c6>=</span> [<span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>2</span>, <span style=color:#bd93f9>3</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>some_func(int_list) <span style=color:#6272a4># works now</span>
</span></span></code></pre></div><p>Sequence is covariant because it&rsquo;s immutable. There&rsquo;s no append method and if you try to assign something to an index (like <code>input[0] = "a"</code>), you&rsquo;ll get a
<span class=sidenote><label class=sidenote-label for=sidenote-2>type error.</label>
<input class=sidenote-checkbox type=checkbox checked id=sidenote-2></input>
<span class="sidenote-content sidenote-right">Note: the input is still a list at runtime. It can be mutated too. The error only shows up during type-checking and using <code>Sequence</code> does not actually prevent any code from mutating the list.</span></span></p><p>Mutability is just one reason for changing the variance. There may be other reasons why a type is co/contra/invariant.</p><h3 id=a-note-on-multiple-type-parameters>A note on multiple type parameters
<a class=heading-anchor href=#a-note-on-multiple-type-parameters>#</a></h3><p>In the <a href=#variance>definition of variance</a> above, we said that &ldquo;<code>Something[T]</code> is co/contra/invariant <strong>in</strong> <code>T</code>&rdquo;. Each type parameter of a generic can have different variance. For example, a function type <code>Function[ParameterType, ReturnType]</code> can be covariant in <code>ReturnType</code> and contravariant in <code>ParameterType</code>. We will see examples of such types in the next section.</p><p>For generics with only a single type parameter, saying &ldquo;list is invariant&rdquo; is equivalent to &ldquo;list[T] is invariant in T&rdquo;.</p><h1 id=other-languages>Other languages
<a class=heading-anchor href=#other-languages>#</a></h1><p>Let&rsquo;s look at a few examples of co/contra/invariance in various languages.</p><h2 id=python>Python
<a class=heading-anchor href=#python>#</a></h2><p>We saw example of covariance (<code>typing.Sequence</code>) and invariance (<code>list</code>) already. Now let&rsquo;s look at an example for contravariance.</p><p>Consider these functions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Media</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#ff79c6>...</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Anime</span>(Media):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#ff79c6>...</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>watch_media</span>(media: Media):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#ff79c6>...</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>watch_anime</span>(anime: Anime):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#ff79c6>...</span>
</span></span></code></pre></div><p>Here <code>Anime &lt;: Media</code> since Anime subclasses Media. Notice here that we don&rsquo;t really use generic types. So how does variance factor in here?</p><p>Generic types show up in the <em>type of the functions</em>. In Python, functions are typed using <code>collections.abc.Callable</code> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. The following are the types of these functions:</p><ul><li><code>watch_media</code> is <code>Callable[[Media], None]</code>: takes one argument of type <code>Media</code> and returns a value of type <code>None</code>.</li><li><code>watch_anime</code> is <code>Callable[[Anime], None]</code>: takes one argument of type <code>Anime</code> and returns a value of type <code>None</code>.</li></ul><p>Now let&rsquo;s consider a function that takes a <code>Callable</code> as an <em>argument</em>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>from</span> collections.abc <span style=color:#ff79c6>import</span> Callable
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>sit_down</span>(watcher: Callable[[Media], <span style=color:#ff79c6>None</span>]):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    watcher(Media())
</span></span></code></pre></div><p>Can we do <code>sit_down(watch_media)</code>? Yes.</p><p>But can we do <code>sit_down(watch_anime)</code>? Nope.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#bd93f9>1.</span> Argument of <span style=color:#8be9fd;font-style:italic>type</span> <span style=color:#f1fa8c>&#34;(anime: Anime) -&gt; None&#34;</span> cannot be assigned to parameter <span style=color:#f1fa8c>&#34;watcher&#34;</span> of <span style=color:#8be9fd;font-style:italic>type</span> <span style=color:#f1fa8c>&#34;(Media) -&gt; None&#34;</span> <span style=color:#ff79c6>in</span> function <span style=color:#f1fa8c>&#34;sit_down&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>   Â Â Type <span style=color:#f1fa8c>&#34;(anime: Anime) -&gt; None&#34;</span> <span style=color:#ff79c6>is</span> <span style=color:#ff79c6>not</span> assignable to <span style=color:#8be9fd;font-style:italic>type</span> <span style=color:#f1fa8c>&#34;(Media) -&gt; None&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>   Â Â Â Â Parameter <span style=color:#bd93f9>1</span>: <span style=color:#8be9fd;font-style:italic>type</span> <span style=color:#f1fa8c>&#34;Media&#34;</span> <span style=color:#ff79c6>is</span> incompatible <span style=color:#ff79c6>with</span> <span style=color:#8be9fd;font-style:italic>type</span> <span style=color:#f1fa8c>&#34;Anime&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>   Â Â Â Â Â Â <span style=color:#f1fa8c>&#34;Media&#34;</span> <span style=color:#ff79c6>is</span> <span style=color:#ff79c6>not</span> assignable to <span style=color:#f1fa8c>&#34;Anime&#34;</span>
</span></span></code></pre></div><p>Logically, the <code>watcher</code> function in <code>sit_down</code> can get called with any type of <code>Media</code>, not just <code>Anime</code>. So we cannot pass a function that assumes it will always get an <code>Anime</code>. This means <code>Callable[[Anime], None]</code> is <em>not</em> a subtype of <code>Callable[[Media], None]</code>. Hence, <code>Callable[[T], ...]</code> is <em>not</em> covariant in T.</p><p>What about doing it the other way around?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>from</span> collections.abc <span style=color:#ff79c6>import</span> Callable
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>sit_down_2</span>(watcher: Callable[[Anime], <span style=color:#ff79c6>None</span>]):
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    watcher(Anime())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>sit_down_2(watch_media)
</span></span></code></pre></div><p><code>watch_media</code> can handle all types of <code>Media</code>. So it can obviously handle an <code>Anime</code>. Now we have <code>Callable[[Media], None] &lt;: Callable[[Anime], None]</code>, even though <code>Anime &lt;: Media</code>. Hence, <code>Callable[[T], ...]</code> is <strong>contravariant</strong> in T.</p><p>In fact, <code>Callable</code> is contravariant in all its argument types. That is, <code>Callable[[A2, B2, C2, ...], ...] &lt;: Callable[[A1, B1, C1, ...], ...]</code> only if <code>A1 &lt;: A2 and B1 &lt;: B2 and C1 &lt;: C2</code> and so on.</p><h2 id=typescript>Typescript
<a class=heading-anchor href=#typescript>#</a></h2><p>Unlike Python, arrays in Typescript are covariant! That means the below program is valid and passes the typechecker. This is <a href=https://www.typescriptlang.org/docs/handbook/type-compatibility.html#a-note-on-soundness>intentional</a> in the design of Typescript.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd;font-style:italic>function</span> some_func(input<span style=color:#ff79c6>:</span> (<span style=color:#8be9fd>number</span> <span style=color:#ff79c6>|</span> <span style=color:#8be9fd>string</span>)[]) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    console.log(input);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    input.push(<span style=color:#f1fa8c>&#34;hello world&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4>// supposed to be an array of numbers only
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> some_array: <span style=color:#8be9fd>number</span>[] <span style=color:#ff79c6>=</span> [<span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>2</span>, <span style=color:#bd93f9>3</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>some_func(some_array);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>console.log(some_array); <span style=color:#6272a4>// [1, 2, 3, &#34;hello world&#34;] - oops!
</span></span></span></code></pre></div><p>Now let&rsquo;s see an example for contravariance. Consider these interfaces:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>interface</span> Media {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>  name: <span style=color:#8be9fd>string</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>interface</span> Anime <span style=color:#ff79c6>extends</span> Media {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>  studio: <span style=color:#8be9fd>string</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#8be9fd;font-style:italic>function</span> watchMedia(media: <span style=color:#8be9fd>Media</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#8be9fd;font-style:italic>function</span> watchAnime(anime: <span style=color:#8be9fd>Anime</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>}
</span></span></code></pre></div><p>Here <code>Anime &lt;: Media</code> since the <code>Anime</code> interface extends the <code>Media</code> interface. Similar to the Python example, we come across variance in the types of <em>functions</em>. The types of the functions we defined can be written as:</p><ul><li><code>watchMedia</code> is <code>(media: Media) => void</code>: takes one argument of type <code>Media</code> and returns nothing.</li><li><code>watchAnime</code> is <code>(anime: Anime) => void</code>: takes one argument of type <code>Anime</code> and returns nothing.</li></ul><p>Now consider this function that takes another function as an argument:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd;font-style:italic>function</span> sitDown(watcher<span style=color:#ff79c6>:</span> (media: <span style=color:#8be9fd>Media</span>) <span style=color:#ff79c6>=&gt;</span> <span style=color:#ff79c6>void</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  watcher({name<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Arcane&#34;</span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span></code></pre></div><p>Can we <code>sitDown(watchMedia)</code>? Yes.</p><p>Can we <code>sitDown(watchAnime)</code>? Nope.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>Argument <span style=color:#ff79c6>of</span> <span style=color:#ff79c6>type</span> <span style=color:#f1fa8c>&#39;(anime: Anime) =&gt; void&#39;</span> <span style=color:#ff79c6>is</span> not assignable to parameter <span style=color:#ff79c6>of</span> <span style=color:#ff79c6>type</span> <span style=color:#f1fa8c>&#39;(media: Media) =&gt; void&#39;</span>.
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  Types <span style=color:#ff79c6>of</span> parameters <span style=color:#f1fa8c>&#39;anime&#39;</span> and <span style=color:#f1fa8c>&#39;media&#39;</span> are incompatible.
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    Property <span style=color:#f1fa8c>&#39;studio&#39;</span> <span style=color:#ff79c6>is</span> missing <span style=color:#ff79c6>in</span> <span style=color:#ff79c6>type</span> <span style=color:#f1fa8c>&#39;Media&#39;</span> but required <span style=color:#ff79c6>in</span> <span style=color:#ff79c6>type</span> <span style=color:#f1fa8c>&#39;Anime&#39;</span>.
</span></span></code></pre></div><p>Logically, the <code>watcher</code> function in <code>sitDown</code> can get called with any type of <code>Media</code>, not just <code>Anime</code>. So we cannot pass a function that assumes it will always get an <code>Anime</code>. This means <code>(anime: Anime) => void</code> is <em>not</em> a subtype of <code>(media: Media) => void</code>. Hence, <code>(value: T): void</code> is <em>not</em> covariant in T.</p><p>What about doing it the other way around?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd;font-style:italic>function</span> sitDown2(watcher<span style=color:#ff79c6>:</span> (media: <span style=color:#8be9fd>Anime</span>) <span style=color:#ff79c6>=&gt;</span> <span style=color:#ff79c6>void</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  watcher({name<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Vinland Saga&#34;</span>, studio<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;WIT&#34;</span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>sitDown2(watchMedia);
</span></span></code></pre></div><p>This is fine because <code>watchMedia</code> can handle any <code>Media</code>. So it can obviously handle an <code>Anime</code>.</p><p>Now we have <code>(media: Media) => void &lt;: (anime: Anime) => void</code> even though <code>Anime &lt;: Media</code>. This is called contravariance and we can say that <code>(value: T): void</code> is <strong>contravariant</strong> in <code>T</code>.</p><p>Invariance in Typescript doesn&rsquo;t show up very often. If you know of better examples than the one I show here, please let me know.</p><p>Consider the following functions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd;font-style:italic>function</span> makeSequel(media: <span style=color:#8be9fd>Media</span>)<span style=color:#ff79c6>:</span> Media {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  <span style=color:#ff79c6>return</span> {name: <span style=color:#8be9fd>media.name</span> <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34; 2&#34;</span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#8be9fd;font-style:italic>function</span> makeSequelAnime(anime: <span style=color:#8be9fd>Anime</span>)<span style=color:#ff79c6>:</span> Anime {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>  <span style=color:#ff79c6>return</span> {name: <span style=color:#8be9fd>anime.name</span> <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34; 2&#34;</span>, studio: <span style=color:#8be9fd>anime.studio</span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div><p>Both of them return a value with the same type as its input. The generic form of such a function would be <code>(value: T) => T</code>. Now consider the below function that takes such a function as its input:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd;font-style:italic>function</span> applyTransform(transformer<span style=color:#ff79c6>:</span> (media: <span style=color:#8be9fd>Media</span>) <span style=color:#ff79c6>=&gt;</span> Media) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  <span style=color:#ff79c6>return</span> transformer({name<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Invincible&#34;</span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span></code></pre></div><p>Here, this works just fine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>applyTransform(makeSequel)
</span></span></code></pre></div><p>But this fails:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>applyTransform(makeSequelAnime)
</span></span></code></pre></div><p>With the following error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>Argument <span style=color:#ff79c6>of</span> <span style=color:#ff79c6>type</span> <span style=color:#f1fa8c>&#39;(anime: Anime) =&gt; Anime&#39;</span> <span style=color:#ff79c6>is</span> not assignable to parameter <span style=color:#ff79c6>of</span> <span style=color:#ff79c6>type</span> <span style=color:#f1fa8c>&#39;(media: Media) =&gt; Media&#39;</span>.
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  Types <span style=color:#ff79c6>of</span> parameters <span style=color:#f1fa8c>&#39;anime&#39;</span> and <span style=color:#f1fa8c>&#39;media&#39;</span> are incompatible.
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    Property <span style=color:#f1fa8c>&#39;studio&#39;</span> <span style=color:#ff79c6>is</span> missing <span style=color:#ff79c6>in</span> <span style=color:#ff79c6>type</span> <span style=color:#f1fa8c>&#39;Media&#39;</span> but required <span style=color:#ff79c6>in</span> <span style=color:#ff79c6>type</span> <span style=color:#f1fa8c>&#39;Anime&#39;</span>.
</span></span></code></pre></div><p>We can say that <code>(value: T) => T</code> is <em>not covariant</em> in T, because <code>(anime: Anime) => Anime</code> is not a subtype of <code>(media: Media) => Media</code>.</p><p>Now consider another function that takes an Anime transformer instead:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd;font-style:italic>function</span> applyAnimeTransform(transformer<span style=color:#ff79c6>:</span> (anime: <span style=color:#8be9fd>Anime</span>) <span style=color:#ff79c6>=&gt;</span> Anime) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  <span style=color:#ff79c6>return</span> transformer({name<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Frieren&#34;</span>, studio<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Madhouse&#34;</span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span></code></pre></div><p>Here, this works fine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>applyAnimeTransform(makeSequelAnime)
</span></span></code></pre></div><p>But this fails:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>applyAnimeTransform(makeSequel)
</span></span></code></pre></div><p>With the following error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>Argument <span style=color:#ff79c6>of</span> <span style=color:#ff79c6>type</span> <span style=color:#f1fa8c>&#39;(media: Media) =&gt; Media&#39;</span> <span style=color:#ff79c6>is</span> not assignable to parameter <span style=color:#ff79c6>of</span> <span style=color:#ff79c6>type</span> <span style=color:#f1fa8c>&#39;(anime: Anime) =&gt; Anime&#39;</span>.
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  Property <span style=color:#f1fa8c>&#39;studio&#39;</span> <span style=color:#ff79c6>is</span> missing <span style=color:#ff79c6>in</span> <span style=color:#ff79c6>type</span> <span style=color:#f1fa8c>&#39;Media&#39;</span> but required <span style=color:#ff79c6>in</span> <span style=color:#ff79c6>type</span> <span style=color:#f1fa8c>&#39;Anime&#39;</span>.
</span></span></code></pre></div><p><code>(media: Media) => Media</code> is <em>not</em> a subtype of <code>(anime: Anime) => Anime</code>, which means that <code>(value: T) => T</code> is <em>not contravariant</em> in <code>T</code>. Since it is neither covariant nor contravariant, we can say that <code>(value: T) => T</code> is <strong>invariant</strong> in <code>T</code>.</p><h2 id=rust>Rust
<a class=heading-anchor href=#rust>#</a></h2><p>Although Rust does not allow defining our own subtypes like in other languages (since it does not support inheritance), there is yet one subtyping relationship that exists. This relationship is on lifetimes instead of type parameters.</p><p>A full explanation of lifetimes would make this post way longer than it already is. I will try explaining them briefly. Lifetimes in Rust are regions of code where a variable is accessible. Consider this example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#8be9fd;font-style:italic>let</span> some_var <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;hello there&#34;</span>.to_owned(); <span style=color:#6272a4>// the lifetime of some_var starts here
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    println!(<span style=color:#f1fa8c>&#34;The value of some_var is </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span>, some_var);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#6272a4>// the lifetime of some_var ends at the end of the block implicitly
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><p>We can cut short the lifetime of a variable by calling <code>drop</code> on it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#8be9fd;font-style:italic>let</span> some_var <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;hello there&#34;</span>.to_owned(); <span style=color:#6272a4>// the lifetime of some_var starts here
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#8be9fd;font-style:italic>drop</span>(some_var); <span style=color:#6272a4>// the lifetime of some_var ends here!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>    <span style=color:#6272a4>// oops can&#39;t use it anymore!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#6272a4></span>    println!(<span style=color:#f1fa8c>&#34;The value of some_var is </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span>, some_var);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>}
</span></span></code></pre></div><p>For most rust programs, lifetimes become a problem when references are involved. They will often be implicit and unnamed like in <code>&amp;str</code>, but sometimes we need to name them like in <code>&'a str</code>. Lifetime names start with apostrophe and are followed by the name. Lifetimes of functions and structs are specified in the same manner as type parameters. In other words, functions and structs can be <em>generic</em> over lifetimes.</p><p>Now let&rsquo;s understand the subtyping relationship between lifetimes. Consider this struct:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>Token</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;a</span><span style=color:#ff79c6>&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#ff79c6>pub</span> session_name: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;a</span> <span style=color:#8be9fd>str</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span></code></pre></div><p>This means that a <code>Token</code> must live at least as long as its <code>session_name</code>. Now consider a function that creates a token:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>create_token_1</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;a</span><span style=color:#ff79c6>&gt;</span>(session_name: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;a</span> <span style=color:#8be9fd>str</span>) -&gt; <span style=color:#50fa7b>Token</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;a</span><span style=color:#ff79c6>&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    Token { session_name }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span></code></pre></div><p>Here too, the returned <code>Token</code> lives at least as long as the <code>session_name</code> being passed in. Rust&rsquo;s borrow checker makes sure of this. Let&rsquo;s create a token and use it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd;font-style:italic>let</span> session_name: <span style=color:#8be9fd;font-style:italic>String</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;browser1&#34;</span>.to_owned();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#8be9fd;font-style:italic>let</span> token <span style=color:#ff79c6>=</span> create_token_1(<span style=color:#ff79c6>&amp;</span>session_name);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4>// this works
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span>println!(<span style=color:#f1fa8c>&#34;I have a token for </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span>, token.session_name);
</span></span></code></pre></div><p>Now if we try to drop the <code>session_name</code> before the usage of <code>token</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd;font-style:italic>let</span> session_name: <span style=color:#8be9fd;font-style:italic>String</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;browser1&#34;</span>.to_owned();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#8be9fd;font-style:italic>let</span> token <span style=color:#ff79c6>=</span> create_token_1(<span style=color:#ff79c6>&amp;</span>session_name);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4>// not allowed!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>drop</span>(session_name);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>println!(<span style=color:#f1fa8c>&#34;I have a token for </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span>, token.session_name);
</span></span></code></pre></div><p>We get an error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>error[E0505]: <span style=color:#50fa7b>cannot</span> <span style=color:#ff79c6>move</span> out of `session_name` because it is borrowed
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>  <span style=color:#ff79c6>-</span>-&gt; <span style=color:#50fa7b>src</span><span style=color:#ff79c6>/</span>bin<span style=color:#ff79c6>/</span>lifetimes.rs:<span style=color:#bd93f9>20</span>:<span style=color:#bd93f9>10</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>   <span style=color:#ff79c6>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#bd93f9>17</span> <span style=color:#ff79c6>|</span>     <span style=color:#8be9fd;font-style:italic>let</span> session_name: <span style=color:#8be9fd;font-style:italic>String</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;browser1&#34;</span>.to_owned();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>   <span style=color:#ff79c6>|</span>         <span style=color:#ff79c6>------------</span> binding `session_name` declared here
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#bd93f9>18</span> <span style=color:#ff79c6>|</span>     <span style=color:#8be9fd;font-style:italic>let</span> token <span style=color:#ff79c6>=</span> create_token_1(<span style=color:#ff79c6>&amp;</span>session_name);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>   <span style=color:#ff79c6>|</span>                                <span style=color:#ff79c6>-------------</span> borrow of `session_name` occurs here
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#bd93f9>19</span> <span style=color:#ff79c6>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#bd93f9>20</span> <span style=color:#ff79c6>|</span>     <span style=color:#8be9fd;font-style:italic>drop</span>(session_name);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>   <span style=color:#ff79c6>|</span>          <span style=color:#ff79c6>^^^^^^^^^^^^</span> <span style=color:#ff79c6>move</span> out of `session_name` occurs here
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#bd93f9>21</span> <span style=color:#ff79c6>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#bd93f9>22</span> <span style=color:#ff79c6>|</span>     println!(<span style=color:#f1fa8c>&#34;I have a token for </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span>, token.session_name);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>   <span style=color:#ff79c6>|</span>                                       <span style=color:#ff79c6>------------------</span> borrow later used here
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>   <span style=color:#ff79c6>|</span>
</span></span></code></pre></div><p>Now let&rsquo;s revisit the function and try to provide different lifetimes for the input and output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>create_token_2</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;a</span>, <span style=color:#50fa7b>&#39;b</span><span style=color:#ff79c6>&gt;</span>(session_name: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;a</span> <span style=color:#8be9fd>str</span>) -&gt; <span style=color:#50fa7b>Token</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;b</span><span style=color:#ff79c6>&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    Token { session_name }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span></code></pre></div><p>This is not allowed. Recall that the definition of <code>Token</code> takes its lifetime from the lifetime of the inner <code>session_name</code>. In this case, we&rsquo;re constructing a <code>Token&lt;'a></code> but the return type requires a <code>Token&lt;'b></code>. <code>'a</code> and <code>'b</code> are two lifetimes with no relationship. We can define this relationship explicitly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>create_token_2</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;a</span>, <span style=color:#50fa7b>&#39;b</span><span style=color:#ff79c6>&gt;</span>(session_name: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;a</span> <span style=color:#8be9fd>str</span>) -&gt; <span style=color:#50fa7b>Token</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;b</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>where</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#50fa7b>&#39;a</span>: <span style=color:#50fa7b>&#39;b</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    Token { session_name }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>}
</span></span></code></pre></div><p>Here <code>'a: 'b</code> means that lifetime <code>'a</code> is at least as long as lifetime <code>'b</code>. In other words, any variable with lifetime <code>'a</code> can be used in the place where a lifetime of <code>'b</code> is needed. That&rsquo;s subtyping! So we can write this as <code>'a &lt;: 'b</code>. Notice here that <code>'a</code> is the <em>longer</em> lifetime compared to <code>'b</code>. Generalizing this, any lifetime <code>'long</code> which encompasses another lifetime <code>'short</code> is a <em>subtype</em>: <code>'long &lt;: 'short</code>.</p><p>There is a special lifetime in Rust named <code>'static</code>. References with a lifetime of <code>'static</code> live for the duration of the program. That is, we can assume that they are never dropped. We can say that the <code>'static</code> lifetime is longer than all other lifetimes. Or in other words, <code>'static</code> is a subtype of all lifetimes.</p><p>Now that the relationship is established, let&rsquo;s look at examples of variance. Actually, we have already looked at covariance. Let&rsquo;s simplify our previous example a bit:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>create_token_3</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;a</span>, <span style=color:#50fa7b>&#39;b</span><span style=color:#ff79c6>&gt;</span>(session_name: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;a</span> <span style=color:#8be9fd>str</span>) -&gt; <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;b</span> <span style=color:#8be9fd>str</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#50fa7b>where</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#50fa7b>&#39;a</span>: <span style=color:#50fa7b>&#39;b</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    session_name
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>}
</span></span></code></pre></div><p>Here we are assigning a <code>&'a str</code> to a <code>&'b str</code>, which means <code>&'a str &lt;: &'b str</code>. Since we know <code>'a &lt;: 'b</code>, we can say that <code>&'a T</code> is
<span class=sidenote><label class=sidenote-label for=sidenote-3><strong>covariant</strong></label>
<input class=sidenote-checkbox type=checkbox checked id=sidenote-3></input>
<span class="sidenote-content sidenote-right"><code>&'a T</code> is also covariant in <code>T</code>. For example, <code>&'a &'b str</code> is a subtype of <code>&'a &'c str</code> if <code>'b &lt;: 'c</code>.
</span></span>in <code>'a</code>.</p><p>Now consider this example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>example</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;long</span>, <span style=color:#50fa7b>&#39;short</span><span style=color:#ff79c6>&gt;</span>(<span style=color:#ff79c6>mut</span> some_str: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;long</span> <span style=color:#8be9fd>str</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>where</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#50fa7b>&#39;long</span>: <span style=color:#50fa7b>&#39;short</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#8be9fd;font-style:italic>let</span> mut_ref_to_ref_str: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>mut</span> <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;short</span> <span style=color:#8be9fd>str</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>&amp;</span><span style=color:#ff79c6>mut</span> some_str;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>}
</span></span></code></pre></div><p>This function defines two lifetimes with the relationship <code>'long &lt;: 'short</code>, i.e., <code>'long</code> lives at least as long as <code>'short</code>. We&rsquo;re passing in a <code>&amp;str</code> with lifetime <code>'long</code>. The <code>mut_ref_to_ref_str</code> is a mutable reference to an immutable reference to a <code>str</code>. In short, it is a mutable reference to a <code>&amp;str</code>. This means we can&rsquo;t modify the inner <code>&amp;str</code>, but we can make <code>mut_ref_to_ref_str</code> point to another <code>&amp;str</code>. Sadly, the above function does not compile:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>error: <span style=color:#50fa7b>lifetime</span> may not live long enough
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>  <span style=color:#ff79c6>-</span>-&gt; <span style=color:#50fa7b>src</span><span style=color:#ff79c6>/</span>bin<span style=color:#ff79c6>/</span>lifetimes.rs:<span style=color:#bd93f9>42</span>:<span style=color:#bd93f9>29</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>   <span style=color:#ff79c6>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#bd93f9>38</span> <span style=color:#ff79c6>|</span> <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>example</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;long</span>, <span style=color:#50fa7b>&#39;short</span><span style=color:#ff79c6>&gt;</span>(<span style=color:#ff79c6>mut</span> some_str: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;long</span> <span style=color:#8be9fd>str</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>   <span style=color:#ff79c6>|</span>            <span style=color:#ff79c6>-----</span>  <span style=color:#ff79c6>------</span> lifetime `<span style=color:#50fa7b>&#39;short</span>` defined here
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>   <span style=color:#ff79c6>|</span>            <span style=color:#ff79c6>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>   <span style=color:#ff79c6>|</span>            lifetime `<span style=color:#50fa7b>&#39;long</span>` defined here
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#ff79c6>..</span>.
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#bd93f9>42</span> <span style=color:#ff79c6>|</span>     <span style=color:#8be9fd;font-style:italic>let</span> mut_ref_to_ref_str: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>mut</span> <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;short</span> <span style=color:#8be9fd>str</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>&amp;</span><span style=color:#ff79c6>mut</span> some_str;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>   <span style=color:#ff79c6>|</span>                             <span style=color:#ff79c6>^^^^^^^^^^^^^^^^</span> <span style=color:#ff79c6>type</span> <span style=color:#50fa7b>annotation</span> requires that `<span style=color:#50fa7b>&#39;short</span>` must outlive `<span style=color:#50fa7b>&#39;long</span>`
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>   <span style=color:#ff79c6>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>   <span style=color:#ff79c6>=</span> help: <span style=color:#50fa7b>consider</span> adding the following bound: `<span style=color:#50fa7b>&#39;short</span>: <span style=color:#50fa7b>&#39;long</span>`
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>   <span style=color:#ff79c6>=</span> note: <span style=color:#50fa7b>requirement</span> occurs because of a mutable reference to `<span style=color:#ff79c6>&amp;</span><span style=color:#8be9fd>str</span>`
</span></span></code></pre></div><p>Even though <code>'long &lt;: 'short</code> and <code>&'long str &lt;: &'short str</code>, <code>&amp;mut &'long str</code> is <em>not</em> a subtype of <code>&amp;mut &'short str</code>. But why is this not allowed? Let&rsquo;s see what happens when this is allowed. We would be allowed to use the mutable reference to make <code>mut_ref_to_ref_str</code> point to a <code>&'short str</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>example</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;long</span>, <span style=color:#50fa7b>&#39;short</span><span style=color:#ff79c6>&gt;</span>(<span style=color:#ff79c6>mut</span> some_str: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;long</span> <span style=color:#8be9fd>str</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>where</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#50fa7b>&#39;long</span>: <span style=color:#50fa7b>&#39;short</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#8be9fd;font-style:italic>let</span> mut_ref_to_ref_str: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>mut</span> <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;short</span> <span style=color:#8be9fd>str</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>&amp;</span><span style=color:#ff79c6>mut</span> some_str;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        <span style=color:#8be9fd;font-style:italic>let</span> short_lived_string: <span style=color:#8be9fd;font-style:italic>String</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;hello there&#34;</span>.to_owned();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        <span style=color:#8be9fd;font-style:italic>let</span> short_ref: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;short</span> <span style=color:#8be9fd>str</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>&amp;</span>short_lived_string;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>        <span style=color:#ff79c6>*</span>mut_ref_to_ref_str <span style=color:#ff79c6>=</span> short_ref;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        <span style=color:#6272a4>// short_lived_string is dropped!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#6272a4>// some_str will not point to a &amp;str with a &#39;short lifetime!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><p>At the end of this function, <code>some_str</code> is actually assigned to <code>short_lived_string</code> which is dropped at the end of the inner block. This means that using <code>some_str</code> after the block is actually a use-after-free! Rust is designed to prevent such memory bugs. So it makes sense that this is not allowed. Hence, we can say that <code>&amp;mut T</code> is <em>not covariant</em> in <code>T</code>.</p><p>If we reverse the assignment to be:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>example</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;long</span>, <span style=color:#50fa7b>&#39;short</span><span style=color:#ff79c6>&gt;</span>(<span style=color:#ff79c6>mut</span> some_str: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;short</span> <span style=color:#8be9fd>str</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>where</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#50fa7b>&#39;long</span>: <span style=color:#50fa7b>&#39;short</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#8be9fd;font-style:italic>let</span> mut_ref_to_ref_str: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>mut</span> <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;long</span> <span style=color:#8be9fd>str</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>&amp;</span><span style=color:#ff79c6>mut</span> some_str;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>}
</span></span></code></pre></div><p>This is obviously wrong since <code>'short</code> is a shorter lifetime. So <code>&amp;mut T</code> is <em>not contravariant</em> in T. The conclusion is that <code>&amp;mut T</code> is <strong>invariant</strong> in <code>T</code>.</p><p>Now let&rsquo;s look at a function that takes another function (pointer) as its argument:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>sit_down</span>(watcher: <span style=color:#50fa7b>fn</span>(<span style=color:#ff79c6>&amp;</span><span style=color:#8be9fd>str</span>)) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#8be9fd;font-style:italic>let</span> anime: <span style=color:#8be9fd;font-style:italic>String</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;vinland saga&#34;</span>.to_owned();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    watcher(<span style=color:#ff79c6>&amp;</span>anime);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>}
</span></span></code></pre></div><p><code>watcher</code> is a function that takes in a <code>&amp;str</code> with some lifetime. We are passing it a temporary, local <code>&amp;str</code> created within in the <code>sit_down</code> function.</p><p>Now let&rsquo;s try to pass it a function that takes a <code>&amp;str</code> with a lifetime that is a subtype. Since <code>'static</code> is a subtype of all lifetimes, let&rsquo;s use that:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>static_watcher</span>(name: <span style=color:#ff79c6>&amp;</span><span style=color:#8be9fd;font-style:italic>&#39;static</span> <span style=color:#8be9fd>str</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    println!(<span style=color:#f1fa8c>&#34;watching static name </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span>, name);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    sit_down(static_watcher);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div><p>This does not work:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>error[E0308]: <span style=color:#50fa7b>mismatched</span> types
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>   <span style=color:#ff79c6>-</span>-&gt; <span style=color:#50fa7b>src</span><span style=color:#ff79c6>/</span>bin<span style=color:#ff79c6>/</span>lifetimes.rs:<span style=color:#bd93f9>120</span>:<span style=color:#bd93f9>14</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#ff79c6>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#bd93f9>120</span> <span style=color:#ff79c6>|</span>     sit_down(static_watcher);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#ff79c6>|</span>     <span style=color:#ff79c6>--------</span> <span style=color:#ff79c6>^^^^^^^^^^^^^^</span> one <span style=color:#ff79c6>type</span> <span style=color:#50fa7b>is</span> more general than the other
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#ff79c6>|</span>     <span style=color:#ff79c6>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#ff79c6>|</span>     arguments to this function are incorrect
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#ff79c6>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#ff79c6>=</span> note: <span style=color:#50fa7b>expected</span> <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>pointer</span> `<span style=color:#ff79c6>for</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;a</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>fn</span>(<span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;a</span> _)`
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>                  found <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>item</span> `<span style=color:#ff79c6>fn</span>(<span style=color:#ff79c6>&amp;</span><span style=color:#8be9fd;font-style:italic>&#39;static</span> _) {static_watcher}`
</span></span></code></pre></div><p><code>static_watcher</code> can only handle strings with a <code>'static</code> lifetime, but within <code>sit_down</code>, we are passing a local string that has a shorter lifetime. This means <code>fn(&'static str)</code> is not a subtype of <code>fn(&'a str)</code> even though <code>'static &lt;: 'a</code>. Hence, we can say that <code>fn(&'a T)</code> is <em>not covariant</em> in <code>'a</code>.</p><p>What about doing it the other way around?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>sit_down_static</span>(watcher: <span style=color:#50fa7b>fn</span>(<span style=color:#ff79c6>&amp;</span><span style=color:#8be9fd;font-style:italic>&#39;static</span> <span style=color:#8be9fd>str</span>)) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    watcher(<span style=color:#f1fa8c>&#34;vinland saga&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>any_ref_watcher</span><span style=color:#ff79c6>&lt;</span><span style=color:#50fa7b>&#39;a</span><span style=color:#ff79c6>&gt;</span>(name: <span style=color:#ff79c6>&amp;</span><span style=color:#50fa7b>&#39;a</span> <span style=color:#8be9fd>str</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    println!(<span style=color:#f1fa8c>&#34;any_ref_watcher watching </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span>, name);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    sit_down_static(any_ref_watcher);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>}
</span></span></code></pre></div><p>Here we&rsquo;re asking for a <code>watcher</code> that can handle <code>&amp;str</code> with static lifetimes and we&rsquo;re passing a function that handles any <code>&'a str</code>. This compiles. We have <code>fn(&'a) &lt;: fn(&'static)</code> even though <code>'static &lt;: 'a</code>. This means that <code>fn(&'a T)</code> is <strong>contravariant</strong> in <code>'a</code>.</p><p>The Rustonomicon has a table summarizing the variance of some common generic types <a href=https://doc.rust-lang.org/nomicon/subtyping.html#variance>here</a>.</p><h3 id=a-note-on-trait-upcasting>A note on trait upcasting
<a class=heading-anchor href=#a-note-on-trait-upcasting>#</a></h3><p>Rust 1.86, which was released in April 2025, introduced <a href=https://blog.rust-lang.org/2025/04/03/Rust-1.86.0.html#trait-upcasting><em>trait upcasting</em></a>. Consider the following traits:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>trait</span> Media {}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#ff79c6>trait</span> Anime: <span style=color:#50fa7b>Media</span> {}
</span></span></code></pre></div><p>The <code>Anime: Media</code> defines a that <code>Media</code> is a <a href=https://doc.rust-lang.org/book/ch20-02-advanced-traits.html#using-supertraits-to-require-one-traits-functionality-within-another-trait><em>supertrait</em></a> of <code>Anime</code>. With 1.86 and above, we can now assign a <code>dyn Anime</code> trait object to a <code>dyn Media</code> trait object. For example, this works:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>Frieren</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>impl</span> Media <span style=color:#ff79c6>for</span> Frieren {}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#ff79c6>impl</span> Anime <span style=color:#ff79c6>for</span> Frieren {}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    <span style=color:#8be9fd;font-style:italic>let</span> some_anime: <span style=color:#8be9fd;font-style:italic>Box</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>dyn</span> Anime<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>Box</span>::new(Frieren);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>    <span style=color:#8be9fd;font-style:italic>let</span> some_media: <span style=color:#8be9fd;font-style:italic>Box</span><span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>dyn</span> Media<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>=</span> some_anime; <span style=color:#6272a4>// this works
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><p>This may look like a subtyping relationship, like <code>Anime &lt;: Media</code>. But nope! It&rsquo;s not. Rust 1.86 does <em>not</em> introduce a new subtyping relationship. Lifetimes are still the only subtypes. Further, <code>Box&lt;T></code> may look like it&rsquo;s covariant in <code>T</code>. This is just coercion and does not involve variance. For more detailed explanations, see the responses to <a href=https://internals.rust-lang.org/t/why-are-fn-types-not-contravariant-in-their-argument-types/22700/2>this discussion on the Rust Internals Forum</a>.</p><hr><p>I hope this blog post helped explain some behavior of type systems through the understanding of variance. Please reach out to me directly for any feedback. Thank you for reading!</p><p>Acknowledgements: Thank you, <em>Sathvik Srinivas</em>, for proofreading and suggesting improvements to this post.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Interestingly, even though Java is a compiled language, it does <em>not</em> do monomorphization. After compilation, a type parameter in a generic class is replaced with <code>object</code>. This <code>object</code> type can store any object in Java. But more importantly, primitives (int, long, float, char, etc.) are not objects. So you can&rsquo;t really have a fast <code>Array&lt;int></code> in Java. You can have an <code>Array&lt;Integer></code>, but values of <code>Integer</code> types take 4x more memory (16 bytes) compared to <code>int</code>s (4 bytes). So a generic <code>Array</code> in Java will always be slower than specific arrays for each type (an <code>ArrayInt</code> for example).&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Yes, there is a module in the Python standard library named <code>abc</code>. In fact, there are two. There&rsquo;s the <a href=https://docs.python.org/3/library/abc.html><code>abc</code></a> module that helps you define Abstract Base Classes (hence ABC). Then there&rsquo;s <a href=https://docs.python.org/3/library/collections.abc.html><code>collections.abc</code></a>.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></section><footer id=footer><strong></strong><div class=social>&nbsp; <a href=https://github.com/Samyak2 target=_blank rel=noopener title=Github><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a> &nbsp;&nbsp; <a href=mailto:samyak201@gmail.com target=_blank rel=noopener title=Email><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a> &nbsp;&nbsp; <a href=https://twitter.com/Samyak210 target=_blank rel=noopener title=Twitter><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a> &nbsp;&nbsp; <a href=https://hachyderm.io/@samyak target=_blank rel=me title=Mastodon><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2"><path d="M23.193 7.879c0-5.206-3.411-6.732-3.411-6.732C18.062.357 15.108.025 12.041.0h-.076c-3.068.025-6.02.357-7.74 1.147.0.0-3.411 1.526-3.411 6.732.0 1.192-.023 2.618.015 4.129.124 5.092.934 10.109 5.641 11.355 2.17.574 4.034.695 5.535.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.129.539c-2.165-.074-4.449-.233-4.799-2.891a5.499 5.499.0 01-.048-.745s2.125.52 4.817.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.507.475-6.507zm-4.024 6.709h-2.497V8.469c0-1.29-.543-1.944-1.628-1.944-1.2.0-1.802.776-1.802 2.312v3.349h-2.483v-3.35c0-1.536-.602-2.312-1.802-2.312-1.085.0-1.628.655-1.628 1.944v6.119H4.832V8.284c0-1.289.328-2.313.987-3.07.68-.758 1.569-1.146 2.674-1.146 1.278.0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104.0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.304z"/></svg></a> &nbsp;</div><strong></strong><p style=color:grey>Â© 2021-2025 Samyak Sarnayak. <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>Some rights reserved</a>.</p></footer></div></body></html>